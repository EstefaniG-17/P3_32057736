---
openapi: 3.0.0
info:
  title: API de libros de Maze Runner
  description: |
    API para la gestión de libros de la saga Maze Runner con autenticación JWT
  version: 1.0.0

servers:
  - url: http://localhost:3000
    description: Servidor de desarrollo


tags:
  - name: Public - Products
    description: Endpoints públicos para consulta de productos
  - name: Admin - Products  
    description: Gestión de productos (requiere autenticación)
  - name: Admin - Categories
    description: Gestión de categorías (requiere autenticación)
  - name: Admin - Tags
    description: Gestión de etiquetas (requiere autenticación)
  - name: Public - Info
    description: Información pública del sistema
  - name: Public - Auth
    description: Endpoints de autenticación
  - name: Admin - Users
    description: Gestión de usuarios

components:
  schemas:
    Product:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Iron Man Mark LXXXV"
        description:
          type: string
          example: "Funko Pop de Iron Man con traje de Endgame"
        price:
          type: number
          format: float
          example: 29.99
        stock:
          type: integer
          example: 50
        sku:
          type: string
          example: "AVG001"
        brand:
          type: string
          example: "Funko"
        publisher:
          type: string
          example: "Marvel"
        movie:
          type: string
          example: "Avengers: Endgame"
        character:
          type: string
          example: "Iron Man"
        edition:
          type: string
          example: "Standard"
        releaseYear:
          type: integer
          example: 2024
        isExclusive:
          type: boolean
          example: false
        slug:
          type: string
          example: "iron-man-mark-lxxxv-avg001"
        CategoryId:
          type: integer
          example: 1
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Category:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Avengers"
        description:
          type: string
          example: "Avengers movie collection"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Tag:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "limited-edition"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Error:
      type: object
      properties:
        status:
          type: string
          example: "error"
        message:
          type: string
          example: "Error description"
    Success:
      type: object
      properties:
        status:
          type: string
          example: "success"
        data:
          type: object
        message:
          type: string
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

paths:
  /ping:
    get:
      tags:
        - Public - Info
      summary: Ping al servidor
      responses:
        '200':
          description: Respuesta exitosa

  /about:
    get:
      tags:
        - Public - Info
      summary: Información del desarrollador
      responses:
        '200':
          description: Información del desarrolladora
          content:
            application/json:
              example:
                status: "success"
                data:
                  nombreCompleto: "Cristhian Alfonzo Angyalbert Padrón Álvarez"
                  cedula: "31031669"
                  seccion: "1"

  /auth/register:
    post:
      tags:
        - Public - Auth
      summary: Registrar nuevo usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - nombreCompleto
                - email
                - password
                - cedula
              properties:
                nombreCompleto:
                  type: string
                  example: "Adriana Padron"
                email:
                  type: string
                  example: "adri@example.com"
                password:
                  type: string
                  example: "password123"
                cedula:
                  type: string
                  example: "12345678"
      responses:
        '201':
          description: Usuario registrado exitosamente
          content:
            application/json:
              example:
                status: "success"
                data:
                  user:
                    id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                    fullName: "Adriana Padron"
                    email: "adri@example.com"
                    cedula: "12345678"
                  token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

  /auth/login:
    post:
      tags:
        - Public - Auth
      summary: Iniciar sesión
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  example: "adri@example.com"
                password:
                  type: string
                  example: "password123"
      responses:
        '200':
          description: Login exitoso
          content:
            application/json:
              example:
                status: "success"
                data:
                  user:
                    id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                    fullName: "Adriana Padron"
                    email: "adri@example.com"
                    cedula: "12345678"
                  token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

  /users:
    get:
      tags:
        - Admin - Users
      summary: Obtener todos los usuarios
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de usuarios obtenida exitosamente
          content:
            application/json:
              example:
                status: "success"
                data:
                  - id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                    fullName: "Adriana Padron"
                    email: "adri@example.com"
                    cedula: "12345678"
                    createdAt: "2024-01-01T00:00:00.000Z"
                    updatedAt: "2024-01-01T00:00:00.000Z"
                  - id: "b2c3d4e5-f6g7-8901-bcde-f23456789012"
                    fullName: "Adriana Padron"
                    email: "adri@example.com"
                    cedula: "87654321"
                    createdAt: "2024-01-01T00:00:00.000Z"
                    updatedAt: "2024-01-01T00:00:00.000Z"

    post:
      tags:
        - Admin - Users
      summary: Crear nuevo usuario
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - fullName
                - email
                - password
                - cedula
              properties:
                fullName:
                  type: string
                  example: "Adriana Padron"
                email:
                  type: string
                  example: "adri@example.com"
                password:
                  type: string
                  example: "password123"
                cedula:
                  type: string
                  example: "11223344"
      responses:
        '201':
          description: Usuario creado exitosamente
          content:
            application/json:
              example:
                status: "success"
                data:
                  id: "c3d4e5f6-g7h8-9012-cdef-345678901234"
                  fullName: "Adriana Padron"
                  email: "adri@example.com"
                  cedula: "11223344"
                  createdAt: "2024-01-01T00:00:00.000Z"
                  updatedAt: "2024-01-01T00:00:00.000Z"

  /users/{id}:
    get:
      tags:
        - Admin - Users
      summary: Obtener usuario por ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Usuario encontrado
          content:
            application/json:
              example:
                status: "success"
                data:
                  id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                  fullName: "Adriana Padron"
                  email: "adri@example.com"
                  cedula: "12345678"
                  createdAt: "2024-01-01T00:00:00.000Z"
                  updatedAt: "2024-01-01T00:00:00.000Z"

    put:
      tags:
        - Admin - Users
      summary: Actualizar usuario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fullName:
                  type: string
                  example: "Adriana Padron"
                email:
                  type: string
                  example: "adri.p@example.com"
                cedula:
                  type: string
                  example: "12345678"
      responses:
        '200':
          description: Usuario actualizado exitosamente
          content:
            application/json:
              example:
                status: "success"
                data:
                  id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                  fullName: "Adriana Padron"
                  email: "adri.p@example.com"
                  cedula: "12345678"
                  updatedAt: "2024-01-02T00:00:00.000Z"

    delete:
      tags:
        - Admin - Users
      summary: Eliminar usuario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Usuario eliminado exitosamente
          content:
            application/json:
              example:
                status: "success"
                data: null
                message: "User deleted successfully"

  /categories:
    get:
      tags:
        - Admin - Categories
      summary: Obtener todas las categorías
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de categorías
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Category'
        '401':
          description: No autorizado
  /categories/{id}:
    get:
      tags:
        - Admin - Categories
      summary: Obtener categoría por ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Categoría encontrada
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Category'
        '404':
          description: Categoría no encontrada
    put:
      tags:
        - Admin - Categories
      summary: Actualizar categoría
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
      responses:
        '200':
          description: Categoría actualizada
        '404':
          description: Categoría no encontrada
    delete:
      tags:
        - Admin - Categories
      summary: Eliminar categoría
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Categoría eliminada
        '404':
          description: Categoría no encontrada

  /tags:
    get:
      tags:
        - Admin - Tags
      summary: Obtener todas las etiquetas
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de etiquetas
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Tag'
    post:
      tags:
        - Admin - Tags
      summary: Crear una nueva etiqueta
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
      responses:
        '201':
          description: Etiqueta creada
        '400':
          description: Datos inválidos

  /tags/{id}:
    get:
      tags:
        - Admin - Tags
      summary: Obtener etiqueta por ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Etiqueta encontrada
        '404':
          description: Etiqueta no encontrada
    put:
      tags:
        - Admin - Tags
      summary: Actualizar etiqueta
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
      responses:
        '200':
          description: Etiqueta actualizada
        '404':
          description: Etiqueta no encontrada
    delete:
      tags:
        - Admin - Tags
      summary: Eliminar etiqueta
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Etiqueta eliminada
        '404':
          description: Etiqueta no encontrada

  /products:
    get:
      tags:
        - Public - Products
      summary: Búsqueda avanzada de productos con filtros
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: category
          in: query
          schema:
            type: integer
        - name: tags
          in: query
          schema:
            type: string
            description: IDs separados por coma
        - name: price_min
          in: query
          schema:
            type: number
        - name: price_max
          in: query
          schema:
            type: number
        - name: search
          in: query
          schema:
            type: string
        - name: movie
          in: query
          schema:
            type: string
        - name: character
          in: query
          schema:
            type: string
        - name: edition
          in: query
          schema:
            type: string
        - name: isExclusive
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: Lista de productos paginada
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          products:
                            type: array
                            items:
                              $ref: '#/components/schemas/Product'
                          pagination:
                            type: object
                            properties:
                              page:
                                type: integer
                              limit:
                                type: integer
                              total:
                                type: integer
                              pages:
                                type: integer
    post:
      tags:
        - Admin - Products
      summary: Crear nuevo producto
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - price
                - sku
                - movie
                - character
                - CategoryId
              properties:
                name:
                  type: string
                description:
                  type: string
                price:
                  type: number
                stock:
                  type: integer
                sku:
                  type: string
                brand:
                  type: string
                publisher:
                  type: string
                movie:
                  type: string
                character:
                  type: string
                edition:
                  type: string
                releaseYear:
                  type: integer
                isExclusive:
                  type: boolean
                CategoryId:
                  type: integer
                tags:
                  type: array
                  items:
                    type: integer
      responses:
        '201':
          description: Producto creado
        '400':
          description: Datos inválidos

  /products/{id}:
    get:
      tags:
        - Admin - Products
      summary: Obtener producto por ID (vista admin)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Producto encontrado
        '404':
          description: Producto no encontrada
    put:
      tags:
        - Admin - Products
      summary: Actualizar producto
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                price:
                  type: number
                stock:
                  type: integer
                sku:
                  type: string
                brand:
                  type: string
                publisher:
                  type: string
                movie:
                  type: string
                character:
                  type: string
                edition:
                  type: string
                releaseYear:
                  type: integer
                isExclusive:
                  type: boolean
                CategoryId:
                  type: integer
                tags:
                  type: array
                  items:
                    type: integer
      responses:
        '200':
          description: Producto actualizado
        '404':
          description: Producto no encontrada
    delete:
      tags:
        - Admin - Products
      summary: Eliminar producto
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Producto eliminado
        '404':
          description: Producto no encontrada

  /p/{id}-{slug}:
    get:
      tags:
        - Public - Products
      summary: Obtener producto por ID y slug (URL self-healing)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Producto encontrado
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Product'
        '301':
          description: Redirección a URL correcta (self-healing)
        '404':
          description: Producto no encontrado

          # Añadir a tu swagger.yaml existente

components:
  schemas:
    Category:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Product:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        price:
          type: number
          format: float
        stock:
          type: integer
        character:
          type: string
        movie:
          type: string
        edition:
          type: string
        number:
          type: integer
        exclusive:
          type: boolean
        slug:
          type: string
        CategoryId:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        Tags:
          type: array
          items:
            $ref: '#/components/schemas/Tag'

paths:
  /categories:
    get:
      tags:
        - Admin - Categories
      security:
        - bearerAuth: []
      responses:
        200:
          description: List of categories
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Category'

  /products:
    get:
      tags:
        - Public - Products
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
        - in: query
          name: category
          schema:
            type: integer
        - in: query
          name: tags
          schema:
            type: string
        - in: query
          name: price_min
          schema:
            type: number
        - in: query
          name: price_max
          schema:
            type: number
        - in: query
          name: search
          schema:
            type: string
        - in: query
          name: character
          schema:
            type: string
        - in: query
          name: movie
          schema:
            type: string
        - in: query
          name: edition
          schema:
            type: string
        - in: query
          name: exclusive
          schema:
            type: boolean
      responses:
        200:
          description: Filtered products with pagination
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      products:
                        type: array
                        items:
                          $ref: '#/components/schemas/Product'
                      pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                          limit:
                            type: integer
                          total:
                            type: integer
                          pages:
                            type: integer

  /p/{id}-{slug}:
    get:
      tags:
        - Public - Products
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
        - in: path
          name: slug
          required: true
          schema:
            type: string
      responses:
        200:
          description: Product details
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/Product'
        301:
          description: Redirect to correct slug
